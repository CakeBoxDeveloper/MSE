<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MSE - –¢–≤–æ–π —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        :root {
            --bg-primary:#000;
            --glass-bg:rgba(255,255,255,.05);
            --glass-border:rgba(255,255,255,.1);
            --text-primary:#999;
            --text-secondary:#888;
            --text-tertiary:#666;
        }
        body {
            font-family:'Inter',-apple-system,BlinkMacSystemFont,sans-serif;
            background:var(--bg-primary);color:var(--text-primary);
            overflow-x:hidden;min-height:100vh;
            -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;
        }
        .container { max-width:1400px;margin:0 auto;padding:0 20px; }

        .icon-gray {
            filter: invert(60%) sepia(0%) saturate(0%) brightness(100%) contrast(100%);
        }
        .icon-gray-dark {
            filter: invert(0%) sepia(0%) saturate(0%) brightness(0%) contrast(100%);
        }

        /* Header */
        header {
            padding:16px 0;position:sticky;top:0;z-index:100;
            backdrop-filter:saturate(180%) blur(20px);
            background:rgba(0,0,0,.72);border-bottom:1px solid var(--glass-border);
        }
        .header-content { display:flex;justify-content:space-between;align-items:center;gap:20px; }
        .logo { width:192px;height:192px;display:flex;align-items:center;justify-content:center;flex-shrink:0; }
        .logo svg { width:100%;height:100%; }
        .header-login-btn {
            padding:6px 14px;background:rgba(255,255,255,.08);border:1px solid var(--glass-border);
            border-radius:5px;color:var(--text-primary);cursor:pointer;font-family:'Inter',sans-serif;
            font-size:13px;font-weight:500;transition:all .2s ease;margin-left:auto;
        }
        .header-login-btn:hover { background:rgba(255,255,255,.14); }

        /* Inner tabs */
        .inner-tabs { display:flex;gap:8px;margin-bottom:16px;flex-shrink:0;align-items:center; }
        .inner-tab {
            padding:8px 14px;background:transparent;border:1px solid var(--text-secondary);
            border-radius:6px;color:var(--text-secondary);cursor:pointer;font-family:'Inter',sans-serif;
            font-size:12px;font-weight:500;transition:all .2s ease;display:flex;align-items:center;gap:6px;
            height:34px;
        }
        .inner-tab-icon { width:14px;height:14px; }
        .inner-tab.active { background:var(--text-secondary);color:var(--bg-primary);border-color:var(--text-secondary); }
        .inner-tab.active .inner-tab-icon { filter: invert(0%) sepia(0%) saturate(0%) brightness(0%) contrast(100%); }
        .inner-tab:hover:not(.active) { border-color:rgba(255,255,255,.3); }

        /* Grid */
        .main-wrapper { margin-top:20px; }
        .content-grid { 
            display:grid;
            grid-template-columns:1fr 1fr;
            grid-template-rows:auto;
            gap:12px;
            margin-bottom:20px;
            align-items:start;
        }
        
        .content-grid.browser-minimized {
            grid-template-columns:auto 1fr;
        }
        
        .content-grid.chat-minimized {
            grid-template-columns:1fr auto;
        }
        
        .content-grid.both-minimized {
            grid-template-columns:auto 1fr auto;
        }
        
        @media(max-width:968px){ 
            .content-grid{ grid-template-columns:1fr; }
            .content-grid.browser-minimized,
            .content-grid.chat-minimized,
            .content-grid.both-minimized {
                grid-template-columns:1fr;
            }
        }

        /* Content block */
        .content-block {
            background:var(--glass-bg);border:1px solid var(--glass-border);border-radius:5px;
            padding:20px;backdrop-filter:saturate(180%) blur(20px);
            display:flex;flex-direction:column;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .content-block:not(.minimized) { min-height:500px; }
        
        .minimized-bar {
            display:none;writing-mode:vertical-lr;text-orientation:mixed;
            align-items:center;justify-content:space-between;cursor:pointer;
            height:100%;padding:16px 10px;
        }
        .minimized-bar .label { 
            font-size:13px;font-weight:500;color:var(--text-secondary);
            letter-spacing:-.2px;transform:rotate(180deg);
        }
        
        .content-block.minimized { 
            min-height:500px;
            width:auto;
            padding:0;
            animation: minimizeBlock 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .content-block.minimized .minimized-bar { display:flex; }
        .content-block.minimized .block-body { display:none; }
        
        @media(max-width:968px) {
            .minimized-bar {
                writing-mode:horizontal-tb;
                flex-direction:row;
                height:auto;
                padding:10px 16px;
            }
            .minimized-bar .label { transform:none; }
            .content-block.minimized {
                min-height:0 !important;
                width:auto;
            }
        }
        
        @keyframes minimizeBlock {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }
        
        .btn-minimize {
            width:34px;height:34px;background:transparent;border:1px solid var(--glass-border);
            border-radius:4px;cursor:pointer;display:flex;align-items:center;justify-content:center;
            transition:all .15s ease;flex-shrink:0;
        }
        .btn-minimize:hover { background:rgba(255,255,255,.08);border-color:rgba(255,255,255,.2); }
        .btn-minimize svg { width:12px;height:12px;stroke:var(--text-secondary);fill:none;stroke-width:2;stroke-linecap:round;transition:transform .2s ease; }
        .content-block.minimized .btn-minimize svg { transform:rotate(180deg); }
        
        .block-body { 
            flex:1;display:flex;flex-direction:column;min-height:0;overflow:hidden;
            animation: expandBlock 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes expandBlock {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }
        
        .content-body { flex:1;display:flex;flex-direction:column;min-height:0; }

        /* Materials list */
        .materials-list { display:grid;gap:10px; }
        .material-item {
            background:rgba(255,255,255,.03);border:1px solid var(--glass-border);border-radius:5px;
            padding:14px;cursor:pointer;transition:all .2s ease;display:flex;align-items:center;gap:12px;
        }
        .material-item:hover { background:rgba(255,255,255,.06);border-color:rgba(255,255,255,.18); }
        .material-icon {
            width:36px;height:36px;background:rgba(255,255,255,.08);border-radius:5px;
            display:flex;align-items:center;justify-content:center;flex-shrink:0;
        }
        .material-icon img { width:20px;height:20px;opacity:.7; }
        .material-info h3 { font-size:14px;font-weight:500;margin-bottom:4px;letter-spacing:-.2px; }
        .material-info p { font-size:12px;color:var(--text-secondary);letter-spacing:-.1px; }

        /* Chat panel */
        .chat-top-bar { 
            display:flex;
            align-items:center;
            gap:8px;
            flex-shrink:0;
            margin-bottom:12px;
            position:relative;
            width:100%;
            overflow:visible;
        }
        
        .chat-new-btn {
            width:34px;height:34px;background:rgba(255,255,255,.06);border:1px solid var(--glass-border);border-radius:5px;
            color:var(--text-tertiary);font-family:'Inter',sans-serif;font-size:18px;font-weight:400;
            cursor:pointer;white-space:nowrap;transition:all .15s ease;flex-shrink:0;
            display:flex;align-items:center;justify-content:center;
        }
        .chat-new-btn:hover { background:rgba(255,255,255,.1);border-color:rgba(255,255,255,.2);color:var(--text-secondary); }
        
        .chat-tabs-wrapper { 
            width:70%;
            position:relative;
            min-width:0;
            overflow:hidden;
            flex-shrink:0;
            flex-grow:0;
        }
        .chat-tabs-wrapper::before,
        .chat-tabs-wrapper::after {
            content:'';position:absolute;top:0;bottom:0;width:50px;z-index:2;pointer-events:none;opacity:0;transition:opacity .3s ease;
        }
        .chat-tabs-wrapper::before {
            left:0;
            background:linear-gradient(to right, var(--glass-bg) 0%, var(--glass-bg) 20%, transparent 100%);
        }
        .chat-tabs-wrapper::after {
            right:0;
            background:linear-gradient(to left, var(--glass-bg) 0%, var(--glass-bg) 20%, transparent 100%);
        }
        .chat-tabs-wrapper.show-left-fade::before { opacity:1; }
        .chat-tabs-wrapper.show-right-fade::after { opacity:1; }
        
        .chat-tabs { display:flex;gap:6px;overflow-x:auto;scrollbar-width:none;scroll-behavior:smooth;width:100%; }
        .chat-tabs::-webkit-scrollbar { display:none; }
        .chat-tab {
            padding:0 10px;height:34px;background:transparent;border:1px solid var(--glass-border);border-radius:5px;
            color:var(--text-secondary);font-family:'Inter',sans-serif;font-size:11px;font-weight:500;
            cursor:pointer;white-space:nowrap;transition:all .15s ease;flex-shrink:0;flex-grow:0;
            display:flex;align-items:center;justify-content:center;
            position:relative;
        }
        .chat-tab:hover:not(.active) { border-color:rgba(255,255,255,.22); }
        .chat-tab.active { background:var(--text-secondary);color:var(--bg-primary);border-color:var(--text-secondary); }

        /* Chat tab dropdown menu */
        .chat-tab-menu {
            position:absolute;
            top:calc(100% + 4px);
            left:50%;
            transform:translateX(-50%);
            background:rgba(30,30,30,.95);
            border:1px solid var(--glass-border);
            border-radius:6px;
            padding:4px;
            display:none;
            flex-direction:column;
            gap:2px;
            z-index:100;
            backdrop-filter:blur(10px);
        }
        .chat-tab-menu.show { display:flex; }
        .chat-tab-menu-item {
            width:32px;height:32px;
            background:transparent;
            border:none;
            border-radius:4px;
            cursor:pointer;
            display:flex;align-items:center;justify-content:center;
            transition:all .15s ease;
            color:var(--text-secondary);
            font-size:14px;
        }
        .chat-tab-menu-item:hover { background:rgba(255,255,255,.1); }
        .chat-tab-menu-item img { width:16px;height:16px; }

        .chat-right-controls {
            display:flex;
            gap:8px;
            align-items:center;
            margin-left:auto;
            flex-shrink:0;
        }

        .chat-search-btn {
            width:34px;height:34px;background:rgba(255,255,255,.06);border:1px solid var(--glass-border);border-radius:5px;
            cursor:pointer;display:flex;align-items:center;justify-content:center;
            transition:all .15s ease;flex-shrink:0;
        }
        .chat-search-btn:hover { background:rgba(255,255,255,.1);border-color:rgba(255,255,255,.2); }
        .chat-search-btn svg { width:14px;height:14px;stroke:var(--text-secondary);fill:none;stroke-width:2;stroke-linecap:round; }

        .chat-search-wrap { 
            position:absolute;
            top:calc(100% + 8px);
            right:0;
            width:200px;
            display:none;
            z-index:50;
        }
        .chat-search-wrap.open { display:block; }
        .chat-search-input {
            width:100%;height:34px;padding:0 12px;background:rgba(30,30,30,.95);
            border:1px solid var(--glass-border);border-radius:5px;color:var(--text-primary);
            font-family:'Inter',sans-serif;font-size:12px;backdrop-filter:blur(10px);
        }
        .chat-search-input:focus { outline:none;border-color:rgba(255,255,255,.2);background:rgba(40,40,40,.95); }
        .chat-search-input::placeholder { color:var(--text-tertiary); }

        .chat-container { display:flex;flex-direction:column;flex:1;min-height:0; }
        .chat-messages { flex:1;overflow-y:auto;padding:10px 0;margin-bottom:12px;display:flex;flex-direction:column;gap:10px; }
        .chat-messages::-webkit-scrollbar { width:4px; }
        .chat-messages::-webkit-scrollbar-track { background:transparent; }
        .chat-messages::-webkit-scrollbar-thumb { background:rgba(255,255,255,.2);border-radius:2px; }
        .chat-message {
            padding:10px 12px;background:rgba(255,255,255,.05);border:1px solid var(--glass-border);
            border-radius:5px;font-size:13px;max-width:85%;line-height:1.5;letter-spacing:-.1px;
        }
        .chat-message.ai { align-self:flex-start; }
        .chat-message.user { align-self:flex-end;background:rgba(255,255,255,.08); }

        .chat-empty-state {
            flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;
            text-align:center;padding:20px 10px;gap:16px;pointer-events:none;
        }
        .chat-empty-state .sofia-icon { width:90px;height:90px;opacity:.5; }
        .chat-empty-state .sofia-icon img { width:100%;height:100%;opacity:.7; }
        .chat-empty-state p { font-size:13px;line-height:1.6;color:var(--text-secondary);letter-spacing:-.15px;max-width:260px; }

        .chat-input-wrapper { display:flex;gap:8px;flex-shrink:0; }
        .chat-input {
            flex:1;padding:10px 12px;background:rgba(255,255,255,.05);border:1px solid var(--glass-border);
            border-radius:5px;color:var(--text-primary);font-family:'Inter',sans-serif;font-size:13px;transition:all .2s ease;
        }
        .chat-input::placeholder { color:var(--text-tertiary); }
        .chat-input:focus { outline:none;background:rgba(255,255,255,.08);border-color:rgba(255,255,255,.2); }
        .chat-send {
            padding:10px 16px;background:rgba(255,255,255,.1);border:1px solid var(--glass-border);
            border-radius:5px;color:var(--text-primary);font-family:'Inter',sans-serif;font-weight:500;
            cursor:pointer;transition:all .2s ease;font-size:13px;display:flex;align-items:center;justify-content:center;
        }
        .chat-send:hover { background:rgba(255,255,255,.15); }
        .chat-send img { width:16px;height:16px;opacity:.7; }

        /* News */
        .news-section { margin:20px 0 40px; }
        .news-header { font-size:15px;font-weight:600;margin-bottom:12px;letter-spacing:-.2px; }
        .news-feed {
            display:flex;gap:12px;overflow-x:auto;padding:10px 0;scroll-behavior:smooth;
            scrollbar-width:thin;scrollbar-color:rgba(255,255,255,.2) transparent;
        }
        .news-feed::-webkit-scrollbar { height:4px; }
        .news-feed::-webkit-scrollbar-track { background:transparent; }
        .news-feed::-webkit-scrollbar-thumb { background:rgba(255,255,255,.2);border-radius:2px; }
        .news-item {
            min-width:260px;width:260px;height:260px;background:var(--glass-bg);border:1px solid var(--glass-border);
            border-radius:5px;backdrop-filter:saturate(180%) blur(20px);padding:16px;cursor:pointer;
            transition:all .2s ease;display:flex;flex-direction:column;justify-content:space-between;
        }
        .news-item:hover { background:rgba(255,255,255,.08);border-color:rgba(255,255,255,.18); }
        .news-category { font-size:11px;text-transform:uppercase;letter-spacing:.5px;color:var(--text-secondary);font-weight:500; }
        .news-title { font-size:15px;font-weight:500;margin:12px 0;line-height:1.4;letter-spacing:-.2px; }
        .news-description { font-size:12px;color:var(--text-secondary);line-height:1.5;letter-spacing:-.1px; }
        .news-date { font-size:11px;color:var(--text-tertiary);margin-top:auto;display:flex;align-items:center;gap:5px; }
        .news-date img { width:12px;height:12px;opacity:.4; }

        /* Empty state */
        .empty-state { text-align:center;padding:60px 20px;color:var(--text-secondary); }
        .empty-state-icon { margin-bottom:16px;opacity:.4; }
        .empty-state-icon img { width:90px;height:90px;opacity:.7; }
        .empty-state h3 { font-size:15px;margin-bottom:8px;color:var(--text-primary);font-weight:500;letter-spacing:-.2px; }
        .empty-state p { font-size:13px;line-height:1.5;letter-spacing:-.1px; }

        /* Auth */
        .auth-overlay {
            position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.8);
            backdrop-filter:saturate(180%) blur(20px);z-index:1000;display:flex;align-items:center;
            justify-content:center;opacity:0;pointer-events:none;transition:opacity .3s ease;
        }
        .auth-overlay.active { opacity:1;pointer-events:all; }
        .auth-modal {
            background:var(--glass-bg);border:1px solid var(--glass-border);border-radius:5px;padding:24px;
            backdrop-filter:saturate(180%) blur(20px);max-width:380px;width:calc(100% - 40px);
            transform:scale(.9);transition:transform .3s ease;
        }
        .auth-overlay.active .auth-modal { transform:scale(1); }
        
        .auth-form { display:flex;flex-direction:column;gap:12px;width:100%; }
        .form-group { display:flex;flex-direction:column;gap:6px;width:100%; }
        .form-label { font-size:12px;font-weight:500;color:var(--text-secondary);letter-spacing:-.1px; }
        
        .form-input {
            padding:10px 12px;background:rgba(255,255,255,.05);border:1px solid var(--glass-border);
            border-radius:5px;color:var(--text-primary);font-family:'Inter',sans-serif;font-size:14px;
            transition:all .2s ease;letter-spacing:-.2px;width:100%;
        }
        .form-input.error { border-color:rgba(255,80,80,.5); }
        .form-input::placeholder { color:var(--text-tertiary); }
        .form-input:focus { outline:none;background:rgba(255,255,255,.08);border-color:rgba(255,255,255,.2); }
        .form-input.error:focus { border-color:rgba(255,80,80,.5); }
        .form-input[type="number"] { -moz-appearance:textfield; }
        .form-input[type="number"]::-webkit-outer-spin-button,.form-input[type="number"]::-webkit-inner-spin-button { -webkit-appearance:none;margin:0; }

        .pin-input-container { display:flex;gap:12px;justify-content:space-between;margin:16px 0;width:100%;max-width:100%;box-sizing:border-box; }
        .pin-digit {
            flex:1;min-width:0;height:60px;background:rgba(255,255,255,.05);border:1px solid var(--glass-border);
            border-radius:8px;color:var(--text-primary);font-family:'Inter',sans-serif;font-size:24px;
            font-weight:600;text-align:center;transition:all .2s ease;
        }
        .pin-digit.error { border-color:rgba(255,80,80,.5) !important; }
        .pin-digit:focus { outline:none;background:rgba(255,255,255,.08);border-color:rgba(255,255,255,.3); }
        .pin-digit.error:focus { border-color:rgba(255,80,80,.5) !important; }
        .pin-digit[type="number"] { -moz-appearance:textfield; }
        .pin-digit[type="number"]::-webkit-outer-spin-button,.pin-digit[type="number"]::-webkit-inner-spin-button { -webkit-appearance:none;margin:0; }

        .auth-buttons { display:flex;gap:8px;margin-top:8px;width:100%; }
        .auth-btn {
            flex:1;padding:10px 16px;background:rgba(255,255,255,.1);border:1px solid var(--glass-border);
            border-radius:5px;color:var(--text-primary);font-family:'Inter',sans-serif;font-weight:500;
            cursor:pointer;transition:all .2s ease;font-size:13px;
        }
        .auth-btn:hover { background:rgba(255,255,255,.15); }
        .auth-btn.primary { background:rgba(255,255,255,.15); }
        .auth-btn.primary:hover { background:rgba(255,255,255,.22); }
        .auth-btn:disabled { opacity:.5;cursor:not-allowed; }
        .auth-switch { margin-top:12px;text-align:center;font-size:12px;color:var(--text-secondary);width:100%; }
        .auth-switch button { background:none;border:none;color:var(--text-primary);cursor:pointer;text-decoration:underline;font-family:'Inter',sans-serif;font-size:12px; }
        
        /* Register form - ALL elements same width */
        .register-form-content {
            display:flex;
            flex-direction:column;
            align-items:stretch;
            width:100%;
        }
        
        .register-form-content .auth-header {
            font-size:18px;font-weight:600;letter-spacing:-.3px;text-align:center;
            margin-bottom:12px;width:100%;
        }
        
        .user-id-display {
            padding:16px;background:rgba(255,255,255,.08);border:1px solid var(--glass-border);
            border-radius:5px;text-align:center;display:flex;align-items:center;justify-content:center;gap:8px;
            width:100%;margin-bottom:12px;
        }
        .user-id-label { font-size:14px;color:var(--text-secondary);letter-spacing:-.2px;font-weight:600; }
        .user-id-number { font-size:14px;font-weight:600;letter-spacing:1px;font-variant-numeric:tabular-nums;color:var(--text-secondary); }

        .register-form-content .auth-form {
            width:100%;
        }

        .register-form-content .form-label-key {
            text-align:center;font-size:14px;font-weight:600;
            display:flex;align-items:center;justify-content:center;gap:8px;
            width:100%;margin-bottom:4px;
        }
        .key-icon { width:20px;height:20px; }

        .checkbox-group { display:flex;align-items:center;gap:8px;width:100%; }
        .checkbox-group input[type="checkbox"] {
            appearance:none;width:18px;height:18px;border:2px solid var(--text-secondary);border-radius:3px;
            cursor:pointer;position:relative;transition:all .2s ease;background:transparent;flex-shrink:0;
        }
        .checkbox-group input[type="checkbox"]:checked { background:var(--text-secondary);border-color:var(--text-secondary); }
        .checkbox-group input[type="checkbox"]:checked::after {
            content:'';position:absolute;left:5px;top:2px;width:4px;height:8px;
            border:solid var(--bg-primary);border-width:0 2px 2px 0;transform:rotate(45deg);
        }
        .checkbox-group label { font-size:12px;color:var(--text-secondary);cursor:pointer; }
        .checkbox-group a { color:var(--text-secondary);text-decoration:underline; }

        .loader {
            width:30px;height:30px;border:2px solid rgba(255,255,255,.1);border-top-color:var(--text-primary);
            border-radius:50%;animation:spin .6s linear infinite;margin:20px auto;
        }
        @keyframes spin { to{transform:rotate(360deg);} }
        .success-text { text-align:center;font-size:14px;color:var(--text-primary);margin-top:12px;font-weight:500; }
        .fullscreen-loader { display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:200px; }
        .fullscreen-success { display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:200px;text-align:center;padding:20px; }
        .fullscreen-success .success-text { font-size:15px;line-height:1.6; }
        .logout-modal { text-align:center; }
        .logout-modal h2 { margin-bottom:12px; }
        .logout-modal p { color:var(--text-secondary);margin-bottom:20px; }

        @media(max-width:768px){ .news-item{ min-width:220px;width:220px;height:220px; } }
        @media(max-width:480px){
            .container{ padding:0 16px; }
            .content-block{ padding:16px; }
            header{ padding:12px 0; }
            .logo{ width:84px;height:84px; }
            .pin-digit{ height:55px;font-size:20px; }
        }
    </style>
</head>
<body>
<header>
  <div class="container">
    <div class="header-content">
      <div class="logo">
        <img class="inner-tab-icon icon-gray" src="https://raw.githubusercontent.com/CakeBoxDeveloper/MSE/c3a01dd59275d25a96184e99df50a8dc3dd27667/MSESVG.svg" alt="">
      </div>
      <button class="header-login-btn" id="headerLoginBtn">–í—Ö–æ–¥ –≤ —Å–µ—Ç—å</button>
    </div>
  </div>
</header>

<div class="container">
  <div class="main-wrapper">
    <div class="content-grid" id="contentGrid">

      <!-- LEFT -->
      <div class="content-block" id="browserBlock">
        <div class="minimized-bar" onclick="toggleMinimize('browserBlock')">
          <span class="label">–ë—Ä–∞—É–∑–µ—Ä</span>
          <button class="btn-minimize">
            <svg viewBox="0 0 12 12"><line x1="1" y1="9" x2="11" y2="9"/></svg>
          </button>
        </div>
        <div class="block-body">
          <div class="inner-tabs">
            <button class="inner-tab active" data-inner="materials">
              <img class="inner-tab-icon icon-gray" src="https://raw.githubusercontent.com/CakeBoxDeveloper/MSE/ffc7247d623b23ad966683313d80a037517dff60/tab_materials.svg" alt="">
              <span>–ú–∞—Ç–µ—Ä–∏–∞–ª—ã</span>
            </button>
            <button class="inner-tab" data-inner="workouts">
              <img class="inner-tab-icon icon-gray" src="https://raw.githubusercontent.com/CakeBoxDeveloper/MSE/d48e325735969dad640d1448cc8dcc659fbb6862/tab_workouts.svg" alt="">
              <span>–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</span>
            </button>
            <button class="inner-tab" data-inner="progress">
              <img class="inner-tab-icon icon-gray" src="https://raw.githubusercontent.com/CakeBoxDeveloper/MSE/ffc7247d623b23ad966683313d80a037517dff60/tab_progress.svg" alt="">
              <span>–ü—Ä–æ–≥—Ä–µ—Å—Å</span>
            </button>
            <button class="btn-minimize" onclick="event.stopPropagation(); toggleMinimize('browserBlock')" style="margin-left:auto;">
              <svg viewBox="0 0 12 12"><line x1="1" y1="9" x2="11" y2="9"/></svg>
            </button>
          </div>
          <div class="content-body" id="main-content"></div>
        </div>
      </div>

      <!-- RIGHT -->
      <div class="content-block" id="chatBlock">
        <div class="minimized-bar" onclick="toggleMinimize('chatBlock')">
          <span class="label">–°–æ—Ñ–∏—è</span>
          <button class="btn-minimize">
            <svg viewBox="0 0 12 12"><line x1="1" y1="9" x2="11" y2="9"/></svg>
          </button>
        </div>
        <div class="block-body">
          <div class="chat-top-bar">
            <button class="chat-new-btn" onclick="addChatTab()">+</button>
            <div class="chat-tabs-wrapper" id="chatTabsWrapper">
              <div class="chat-tabs" id="chatTabs">
                <button class="chat-tab active" data-chat="sofia" data-base="true" onclick="closeAllMenus(); switchChatTab('sofia');">–°–æ—Ñ–∏—è</button>
              </div>
            </div>
            <div class="chat-right-controls">
              <button class="chat-search-btn" onclick="toggleChatSearch()">
                <svg viewBox="0 0 16 16"><circle cx="6" cy="6" r="4"/><line x1="9" y1="9" x2="14" y2="14"/></svg>
              </button>
              <button class="btn-minimize" onclick="event.stopPropagation(); toggleMinimize('chatBlock')">
                <svg viewBox="0 0 12 12"><line x1="1" y1="9" x2="11" y2="9"/></svg>
              </button>
            </div>
            <div class="chat-search-wrap" id="chatSearchWrap">
              <input type="text" class="chat-search-input" id="chatSearchInput" placeholder="–ü–æ–∏—Å–∫ —á–∞—Ç–æ–≤‚Ä¶">
            </div>
          </div>
          <div class="chat-container">
            <div class="chat-messages" id="chat-messages"></div>
            <div class="chat-input-wrapper">
              <input type="text" class="chat-input" id="chat-input" placeholder="–ó–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å –°–æ—Ñ–∏–∏...">
              <button class="chat-send" id="chat-send">
                <img class="icon-gray" src="https://raw.githubusercontent.com/CakeBoxDeveloper/MSE/f4325dd706d24eb3c1058e176da6daac524a38e8/send.svg" alt="">
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- News -->
    <div class="news-section">
      <h2 class="news-header">–ù–æ–≤–æ—Å—Ç–∏ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è</h2>
      <div class="news-feed">
        <div class="news-item">
          <div class="news-category">–ù–æ–≤–æ—Å—Ç—å</div>
          <h3 class="news-title">–ù–æ–≤–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∞</h3>
          <p class="news-description">–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–∞—è 30-–¥–Ω–µ–≤–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ –¥–ª—è –Ω–∞–±–æ—Ä–∞ –º—ã—à–µ—á–Ω–æ–π –º–∞—Å—Å—ã –æ—Ç –ø—Ä–æ—Ñ–∏</p>
          <div class="news-date"><img class="icon-gray" src="icons/calendar.svg" alt="">2 –¥–Ω—è –Ω–∞–∑–∞–¥</div>
        </div>
        <div class="news-item">
          <div class="news-category">–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ</div>
          <h3 class="news-title">–£–ª—É—á—à–µ–Ω–∞ –°–æ—Ñ–∏—è</h3>
          <p class="news-description">–¢–µ–ø–µ—Ä—å AI –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–ª–∞–Ω—ã –ø–∏—Ç–∞–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–∞—à–∏—Ö —Ü–µ–ª–µ–π</p>
          <div class="news-date"><img class="icon-gray" src="icons/calendar.svg" alt="">5 –¥–Ω–µ–π –Ω–∞–∑–∞–¥</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- AUTH MODAL -->
<div class="auth-overlay" id="authOverlay">
  <div class="auth-modal">
    <div id="loginForm">
      <div id="loginContent">
        <h2 class="auth-header" style="font-size:18px;font-weight:600;margin-bottom:8px;letter-spacing:-.3px;text-align:center;">–í—Ö–æ–¥ –≤ —Å–µ—Ç—å</h2>
        <form class="auth-form" onsubmit="return false;">
          <div class="form-group" id="stepId">
            <input type="number" class="form-input" id="loginId" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∑–≤–µ–Ω–∞" autocomplete="off">
          </div>
          <div id="loginTransitionLoader" style="display:none;"><div class="loader"></div></div>
          <div class="form-group" id="stepPin" style="display:none;">
            <div class="pin-input-container">
              <input type="number" class="pin-digit" id="loginPin1" maxlength="1" autocomplete="off">
              <input type="number" class="pin-digit" id="loginPin2" maxlength="1" autocomplete="off">
              <input type="number" class="pin-digit" id="loginPin3" maxlength="1" autocomplete="off">
              <input type="number" class="pin-digit" id="loginPin4" maxlength="1" autocomplete="off">
            </div>
          </div>
          <div class="auth-buttons" id="loginButtons">
            <button type="button" class="auth-btn" onclick="closeAuth()">–û—Ç–º–µ–Ω–∞</button>
          </div>
        </form>
        <div class="auth-switch">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <button onclick="showRegister()">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ MSE</button></div>
      </div>
      <div id="loginToRegisterLoader" class="fullscreen-loader" style="display:none;"><div class="loader"></div></div>
      <div id="loginLoader" class="fullscreen-loader" style="display:none;"><div class="loader"></div></div>
      <div id="loginSuccess" class="fullscreen-success" style="display:none;"><div class="success-text">–í—Ö–æ–¥ —Ä–∞–∑—Ä–µ—à—ë–Ω</div></div>
    </div>
    <div id="registerForm" style="display:none;">
      <div id="registerContent">
        <div class="register-form-content">
          <h2 class="auth-header">–ù–æ–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ç–∏ MSE</h2>
          <div class="user-id-display">
            <span class="user-id-label">–í—ã —Å—Ç–∞–Ω–µ—Ç–µ –∑–≤–µ–Ω–æ–º –ø–æ–¥ –Ω–æ–º–µ—Ä–æ–º:</span>
            <span class="user-id-number" id="newUserId">----</span>
          </div>
          <form class="auth-form" onsubmit="return false;">
            <div class="form-label-key">
              <img class="key-icon icon-gray" src="https://raw.githubusercontent.com/CakeBoxDeveloper/MSE/86e9d94bad44abbb9f11716894a6a30d68de3fac/key.svg" alt="">
              <span>–°–æ–∑–¥–∞–π—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–ª—é—á –¥–æ—Å—Ç—É–ø–∞</span>
            </div>
            <div class="pin-input-container">
              <input type="number" class="pin-digit" id="pin1" maxlength="1" autocomplete="off">
              <input type="number" class="pin-digit" id="pin2" maxlength="1" autocomplete="off">
              <input type="number" class="pin-digit" id="pin3" maxlength="1" autocomplete="off">
              <input type="number" class="pin-digit" id="pin4" maxlength="1" autocomplete="off">
            </div>
            <div class="checkbox-group">
              <input type="checkbox" id="termsCheckbox">
              <label for="termsCheckbox">–Ø –ø—Ä–∏–Ω–∏–º–∞—é <a href="#" target="_blank">—É—Å–ª–æ–≤–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ç–∏ MSE</a></label>
            </div>
            <div class="auth-buttons" id="registerButtons">
              <button type="button" class="auth-btn" onclick="closeAuth()">–û—Ç–º–µ–Ω–∞</button>
              <button type="submit" class="auth-btn primary" onclick="register()" id="registerBtn" disabled>–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
            </div>
          </form>
        </div>
      </div>
      <div id="registerLoader" class="fullscreen-loader" style="display:none;"><div class="loader"></div></div>
      <div id="registerSuccess" class="fullscreen-success" style="display:none;"><div class="success-text"></div></div>
    </div>
    <div id="logoutModal" style="display:none;">
      <div class="logout-modal">
        <h2 class="auth-header" style="font-size:18px;font-weight:600;margin-bottom:12px;letter-spacing:-.3px;text-align:center;">–í—ã—Ö–æ–¥ –∏–∑ —Å–µ—Ç–∏</h2>
        <p class="auth-description" style="font-size:13px;color:var(--text-secondary);margin-bottom:20px;line-height:1.5;text-align:center;">–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞?</p>
        <div class="auth-buttons">
          <button type="button" class="auth-btn" onclick="closeAuth()">–û—Ç–º–µ–Ω–∞</button>
          <button type="button" class="auth-btn primary" onclick="confirmLogout()">–í—ã–π—Ç–∏</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
function toggleMinimize(id) { 
    const block = document.getElementById(id);
    block.classList.toggle('minimized');
    updateGridLayout();
}

function updateGridLayout() {
    const grid = document.getElementById('contentGrid');
    const browser = document.getElementById('browserBlock');
    const chat = document.getElementById('chatBlock');
    
    const browserMin = browser.classList.contains('minimized');
    const chatMin = chat.classList.contains('minimized');
    
    grid.classList.remove('browser-minimized', 'chat-minimized', 'both-minimized');
    
    if (browserMin && chatMin) {
        grid.classList.add('both-minimized');
    } else if (browserMin) {
        grid.classList.add('browser-minimized');
    } else if (chatMin) {
        grid.classList.add('chat-minimized');
    }
}

let users = [{ id:1001, pin:'1234', createdAt: new Date().toISOString() }];
let currentUser = null;

document.getElementById('headerLoginBtn').addEventListener('click', () => { currentUser ? showLogout() : showLogin(); });

function showLogin() {
    document.getElementById('loginForm').style.display='block';
    document.getElementById('registerForm').style.display='none';
    document.getElementById('logoutModal').style.display='none';
    document.getElementById('loginContent').style.display='block';
    document.getElementById('stepId').style.display='flex';
    document.getElementById('stepPin').style.display='none';
    document.getElementById('loginTransitionLoader').style.display='none';
    document.getElementById('loginToRegisterLoader').style.display='none';
    document.getElementById('loginLoader').style.display='none';
    document.getElementById('loginSuccess').style.display='none';
    document.getElementById('loginButtons').style.display='flex';
    document.getElementById('loginId').value='';
    ['loginPin1','loginPin2','loginPin3','loginPin4'].forEach(id=>document.getElementById(id).value='');
    document.getElementById('loginId').classList.remove('error');
    loginIdChecked=false;
    document.getElementById('authOverlay').classList.add('active');
    setTimeout(()=>document.getElementById('loginId').focus(),300);
}
function showRegister() {
    document.getElementById('loginContent').style.display='none';
    document.getElementById('loginToRegisterLoader').style.display='flex';
    setTimeout(()=>{
        document.getElementById('loginForm').style.display='none';
        document.getElementById('registerForm').style.display='block';
        document.getElementById('logoutModal').style.display='none';
        const newId=users.length>0?Math.max(...users.map(u=>u.id))+1:1001;
        document.getElementById('newUserId').textContent=newId.toString().padStart(4,'0');
        document.getElementById('registerContent').style.display='block';
        ['pin1','pin2','pin3','pin4'].forEach(id=>document.getElementById(id).value='');
        document.getElementById('termsCheckbox').checked=false;
        document.getElementById('registerBtn').disabled=true;
        document.getElementById('registerLoader').style.display='none';
        document.getElementById('registerSuccess').style.display='none';
        document.getElementById('registerButtons').style.display='flex';
        document.getElementById('loginContent').style.display='block';
        document.getElementById('loginToRegisterLoader').style.display='none';
    },800);
}
function showLogout() {
    document.getElementById('loginForm').style.display='none';
    document.getElementById('registerForm').style.display='none';
    document.getElementById('logoutModal').style.display='block';
    document.getElementById('authOverlay').classList.add('active');
}
function closeAuth() { document.getElementById('authOverlay').classList.remove('active'); }
function confirmLogout() { currentUser=null; document.getElementById('headerLoginBtn').textContent='–í—Ö–æ–¥ –≤ —Å–µ—Ç—å'; closeAuth(); }

let loginIdChecked=false;
function checkLoginId() {
    const input=document.getElementById('loginId');
    if(input.value.length>4) input.value=input.value.slice(0,4);
    const val=input.value.trim();
    if(val===''){input.classList.remove('error');return;}
    input.classList.remove('error');
    if(val.length===4&&!loginIdChecked){
        const id=parseInt(val);
        const exists=users.find(u=>u.id===id);
        if(exists){
            loginIdChecked=true;
            document.getElementById('stepId').style.display='none';
            document.getElementById('loginTransitionLoader').style.display='block';
            setTimeout(()=>{
                document.getElementById('loginTransitionLoader').style.display='none';
                document.getElementById('stepPin').style.display='flex';
                setTimeout(()=>document.getElementById('loginPin1').focus(),100);
            },800);
        } else { input.classList.add('error'); }
    }
}
(function(){
    const el=document.getElementById('loginId');
    el.addEventListener('input',checkLoginId);
    el.addEventListener('keyup',checkLoginId);
    el.addEventListener('input',function(){if(this.value.trim().length<4)loginIdChecked=false;});
})();

const loginPinInputs=['loginPin1','loginPin2','loginPin3','loginPin4'];
loginPinInputs.forEach((id,index)=>{
    const input=document.getElementById(id);
    input.addEventListener('input',function(){
        loginPinInputs.forEach(p=>document.getElementById(p).classList.remove('error'));
        if(this.value.length>1)this.value=this.value.slice(0,1);
        if(this.value.length===1&&index<loginPinInputs.length-1)document.getElementById(loginPinInputs[index+1]).focus();
        const allFilled=loginPinInputs.every(p=>document.getElementById(p).value.length===1);
        if(allFilled){
            const pin=loginPinInputs.map(p=>document.getElementById(p).value).join('');
            const uid=parseInt(document.getElementById('loginId').value);
            const user=users.find(u=>u.id===uid&&u.pin===pin);
            if(user){
                document.getElementById('loginContent').style.display='none';
                document.getElementById('loginLoader').style.display='flex';
                setTimeout(()=>{
                    document.getElementById('loginLoader').style.display='none';
                    document.getElementById('loginSuccess').style.display='flex';
                    setTimeout(()=>{currentUser=user;closeAuth();document.getElementById('headerLoginBtn').textContent='–ó–≤–µ–Ω–æ '+currentUser.id.toString().padStart(4,'0');},1000);
                },2000);
            } else {
                document.getElementById('loginPin1').focus();
                requestAnimationFrame(()=>{loginPinInputs.forEach(p=>document.getElementById(p).classList.add('error'));});
                setTimeout(()=>{loginPinInputs.forEach(p=>{const inp=document.getElementById(p);inp.classList.remove('error');inp.value='';}); document.getElementById('loginPin1').focus();},500);
            }
        }
    });
    input.addEventListener('keydown',function(e){if(e.key==='Backspace'&&this.value===''&&index>0)document.getElementById(loginPinInputs[index-1]).focus();});
});

const pinInputs=['pin1','pin2','pin3','pin4'];
pinInputs.forEach((id,index)=>{
    const input=document.getElementById(id);
    input.addEventListener('input',function(){
        if(this.value.length>1)this.value=this.value.slice(0,1);
        if(this.value.length===1&&index<pinInputs.length-1)document.getElementById(pinInputs[index+1]).focus();
        checkRegisterButton();
    });
    input.addEventListener('keydown',function(e){if(e.key==='Backspace'&&this.value===''&&index>0)document.getElementById(pinInputs[index-1]).focus();});
});
document.getElementById('termsCheckbox').addEventListener('change',checkRegisterButton);
function checkRegisterButton(){
    const allFilled=pinInputs.every(id=>document.getElementById(id).value.length===1);
    document.getElementById('registerBtn').disabled=!(allFilled&&document.getElementById('termsCheckbox').checked);
}
function register(){
    const pin=pinInputs.map(id=>document.getElementById(id).value).join('');
    const userId=parseInt(document.getElementById('newUserId').textContent);
    if(pin.length!==4||!document.getElementById('termsCheckbox').checked)return;
    document.getElementById('registerContent').style.display='none';
    document.getElementById('registerLoader').style.display='flex';
    setTimeout(()=>{
        const newUser={id:userId,pin,createdAt:new Date().toISOString()};
        users.push(newUser);currentUser=newUser;
        document.getElementById('registerLoader').style.display='none';
        document.getElementById('registerSuccess').style.display='flex';
        document.getElementById('registerSuccess').querySelector('.success-text').innerHTML=`–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ, –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª–æ—Å—å –Ω–æ–≤–æ–µ –∑–≤–µ–Ω–æ #${userId.toString().padStart(4,'0')}`;
        setTimeout(()=>{closeAuth();document.getElementById('headerLoginBtn').textContent='–ó–≤–µ–Ω–æ '+currentUser.id.toString().padStart(4,'0');},2500);
    },2000);
}

const TAB_DEFAULTS={
    materials:'https://raw.githubusercontent.com/CakeBoxDeveloper/MSE/d252d71940705d10f712f6c0926dc19d2b4b9c59/default_material.svg',
    workouts:'https://raw.githubusercontent.com/CakeBoxDeveloper/MSE/d252d71940705d10f712f6c0926dc19d2b4b9c59/default_workout.svg',
    progress:'https://raw.githubusercontent.com/CakeBoxDeveloper/MSE/d252d71940705d10f712f6c0926dc19d2b4b9c59/progress_empty.svg'
};
const tabData={
    materials:[
        {title:'–û—Å–Ω–æ–≤—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–∏—Ç–∞–Ω–∏—è',desc:'–ì–∞–π–¥ –ø–æ –º–∞–∫—Ä–æ–Ω—É—Ç—Ä–∏–µ–Ω—Ç–∞–º –∏ –∫–∞–ª–æ—Ä–∏—è–º',icon:TAB_DEFAULTS.materials},
        {title:'–¢–µ—Ö–Ω–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π',desc:'–í–∏–¥–µ–æ-—É—Ä–æ–∫–∏ –æ—Ç –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–æ–≤',icon:TAB_DEFAULTS.materials},
        {title:'–ü—Ä–æ–≥—Ä–∞–º–º—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫',desc:'–ì–æ—Ç–æ–≤—ã–µ –ø–ª–∞–Ω—ã –Ω–∞ —Ä–∞–∑–Ω—ã–µ —Ü–µ–ª–∏',icon:TAB_DEFAULTS.materials},
        {title:'–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ —Å—Ç—Ä–µ—Ç—á–∏–Ω–≥',desc:'–£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –¥–ª—è –≥–∏–±–∫–æ—Å—Ç–∏ –∏ —Ä–µ–ª–∞–∫—Å–∞—Ü–∏–∏',icon:TAB_DEFAULTS.materials}
    ],
    workouts:[
        {title:'–°–∏–ª–æ–≤–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ ‚Äî –î–µ–Ω—å 1',desc:'–ì—Ä—É–¥—å –∏ —Ç—Ä–∏—Ü–µ–ø—Å ¬∑ 45 –º–∏–Ω—É—Ç',icon:TAB_DEFAULTS.workouts},
        {title:'–ö–∞—Ä–¥–∏–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞',desc:'HIIT –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã ¬∑ 30 –º–∏–Ω—É—Ç',icon:TAB_DEFAULTS.workouts},
        {title:'–°–∏–ª–æ–≤–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ ‚Äî –î–µ–Ω—å 2',desc:'–°–ø–∏–Ω–∞ –∏ –±–∏—Ü–µ–ø—Å ¬∑ 50 –º–∏–Ω—É—Ç',icon:TAB_DEFAULTS.workouts},
        {title:'–î–µ–Ω—å –Ω–æ–≥',desc:'–ö–≤–∞–¥—Ä–∏—Ü–µ–ø—Å—ã, –±–∏—Ü–µ–ø—Å—ã –±–µ–¥—Ä–∞ ¬∑ 60 –º–∏–Ω—É—Ç',icon:TAB_DEFAULTS.workouts}
    ]
};
function renderItemList(items){
    return '<div class="materials-list">'+items.map(item=>`<div class="material-item"><div class="material-icon"><img class="icon-gray" src="${item.icon}" alt=""></div><div class="material-info"><h3>${item.title}</h3><p>${item.desc}</p></div></div>`).join('')+'</div>';
}
function renderProgress(){
    return `<div class="empty-state"><div class="empty-state-icon"><img class="icon-gray" src="${TAB_DEFAULTS.progress}" alt=""></div><h3>–ü—Ä–æ–≥—Ä–µ—Å—Å –∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h3><p>–ó–¥–µ—Å—å –°–æ—Ñ–∏—è –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –≤–∞—à–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∏ –∑–∞–ø–∏—Å–∏ –ø–æ –º–µ—Ä–µ —É—Å–ø–µ—Ö–∞ –≤ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞—Ö. –ù–∞—á–Ω–∏—Ç–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å—Å—è, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Å–≤–æ–π –ø—É—Ç—å –∫ –ø—Ä–æ–≥—Ä–µ—Å—Å—É!</p></div>`;
}
function getTabHTML(key){ return key==='progress'?renderProgress():renderItemList(tabData[key]); }

const innerTabs=document.querySelectorAll('.inner-tab');
const mainContent=document.getElementById('main-content');
mainContent.innerHTML=getTabHTML('materials');
innerTabs.forEach(tab=>{
    tab.addEventListener('click',()=>{
        innerTabs.forEach(t=>t.classList.remove('active'));
        tab.classList.add('active');
        mainContent.style.opacity='0';
        setTimeout(()=>{mainContent.innerHTML=getTabHTML(tab.dataset.inner);mainContent.style.opacity='1';},150);
    });
});

let chatTabCounter=1;
let activeChatTab='sofia';
const chatStore={sofia:[]};
let openMenu = null;

function createChatTabElement(id, name, isBase = false) {
    const tab = document.createElement('button');
    tab.className = 'chat-tab';
    tab.dataset.chat = id;
    if (isBase) tab.dataset.base = 'true';
    
    const nameSpan = document.createElement('span');
    nameSpan.textContent = name;
    tab.appendChild(nameSpan);
    
    if (!isBase) {
        const menu = document.createElement('div');
        menu.className = 'chat-tab-menu';
        menu.innerHTML = `
            <button class="chat-tab-menu-item" data-action="pin" title="–ó–∞–∫—Ä–µ–ø–∏—Ç—å">üìå</button>
            <button class="chat-tab-menu-item" data-action="delete" title="–£–¥–∞–ª–∏—Ç—å">üóë</button>
            <button class="chat-tab-menu-item" data-action="rename" title="–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å">‚úè</button>
        `;
        tab.appendChild(menu);
        
        menu.querySelectorAll('.chat-tab-menu-item').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.stopPropagation();
                const action = btn.dataset.action;
                if (action === 'delete') {
                    deleteChatTab(id);
                } else if (action === 'rename') {
                    renameChatTab(id, nameSpan);
                }
                closeAllMenus();
            });
        });
    }
    
    tab.addEventListener('click', (e) => {
        if (e.target.closest('.chat-tab-menu')) return;
        
        // Switch to this tab
        switchChatTab(id);
        
        // If clicking on non-base active tab, show menu
        if (!isBase && tab.classList.contains('active')) {
            const menu = tab.querySelector('.chat-tab-menu');
            if (menu) {
                const wasOpen = menu.classList.contains('show');
                closeAllMenus();
                if (!wasOpen) {
                    menu.classList.add('show');
                    openMenu = menu;
                }
            }
        } else {
            closeAllMenus();
        }
    });
    
    return tab;
}

function closeAllMenus() {
    document.querySelectorAll('.chat-tab-menu.show').forEach(m => m.classList.remove('show'));
    openMenu = null;
}

document.addEventListener('click', (e) => {
    if (!e.target.closest('.chat-tab-menu') && !e.target.closest('.chat-tab')) {
        closeAllMenus();
    }
});

function addChatTab(){
    const id='chat'+chatTabCounter++;
    chatStore[id]=[];
    const tab = createChatTabElement(id, '–ß–∞—Ç '+(chatTabCounter-1));
    document.getElementById('chatTabs').appendChild(tab);
    switchChatTab(id);
    updateChatScrollFade();
}

function deleteChatTab(id) {
    const tab = document.querySelector(`.chat-tab[data-chat="${id}"]`);
    if (tab) {
        tab.remove();
        delete chatStore[id];
        if (activeChatTab === id) {
            switchChatTab('sofia');
        }
        updateChatScrollFade();
    }
}

function renameChatTab(id, nameSpan) {
    const currentName = nameSpan.textContent;
    const newName = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –∏–º—è —á–∞—Ç–∞:', currentName);
    if (newName && newName.trim()) {
        nameSpan.textContent = newName.trim();
    }
}

function switchChatTab(id){
    activeChatTab=id;
    document.querySelectorAll('.chat-tab').forEach(t=>t.classList.toggle('active',t.dataset.chat===id));
    renderChatMessages();
}

function updateChatScrollFade(){
    const wrapper=document.getElementById('chatTabsWrapper');
    const tabs=document.getElementById('chatTabs');
    const isScrollable=tabs.scrollWidth>tabs.clientWidth;
    const isAtStart=tabs.scrollLeft<=1;
    const isAtEnd=tabs.scrollLeft+tabs.clientWidth>=tabs.scrollWidth-1;
    
    wrapper.classList.toggle('show-left-fade',isScrollable&&!isAtStart);
    wrapper.classList.toggle('show-right-fade',isScrollable&&!isAtEnd);
}
document.getElementById('chatTabs').addEventListener('scroll',updateChatScrollFade);
window.addEventListener('resize',updateChatScrollFade);
setTimeout(updateChatScrollFade,100);

function toggleChatSearch(){
    const wrap=document.getElementById('chatSearchWrap');
    wrap.classList.toggle('open');
    if(wrap.classList.contains('open')){
        document.getElementById('chatSearchInput').focus();
    }
}
document.getElementById('chatSearchInput').addEventListener('input',function(){
    const q=this.value.toLowerCase();
    document.querySelectorAll('.chat-tab').forEach(tab=>{
        const nameSpan = tab.querySelector('span');
        const name = nameSpan ? nameSpan.textContent.toLowerCase() : '';
        tab.style.display=name.includes(q)?'':'none';
    });
});

// Close search when clicking outside
document.addEventListener('click', (e) => {
    const wrap = document.getElementById('chatSearchWrap');
    const btn = document.querySelector('.chat-search-btn');
    if (!wrap.contains(e.target) && !btn.contains(e.target)) {
        wrap.classList.remove('open');
    }
});

function renderChatMessages(){
    const container=document.getElementById('chat-messages');
    const messages=chatStore[activeChatTab]||[];
    if(messages.length===0){
        container.innerHTML=`<div class="chat-empty-state"><div class="sofia-icon"><img class="icon-gray" src="https://raw.githubusercontent.com/CakeBoxDeveloper/MSE/d252d71940705d10f712f6c0926dc19d2b4b9c59/progress_empty.svg" alt=""></div><p>–ü—Ä–∏–≤–µ—Ç, –º–µ–Ω—è –∑–æ–≤—É—Ç –°–æ—Ñ–∏—è, —è —Å–æ–∑–¥–∞–Ω–∞ –∏–Ω–∂–µ–Ω–µ—Ä–∞–º–∏ –ø—Ä–æ–µ–∫—Ç–∞ MSE. –Ø —Å–º–æ—Ç—Ä—é –∫–∞–∫ —Ç—ã —Ç—Ä–µ–Ω–∏—Ä—É–µ—à—å—Å—è, –∫–∞–∫ –ø–∏—Ç–∞–µ—à—å—Å—è –∏ –ø–æ–º–æ–≥–∞—é –ø—Ä–æ–≥—Ä–µ—Å—Å–∏—Ä–æ–≤–∞—Ç—å. –Ø –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Å–ø–ª—é.</p></div>`;
    } else {
        container.innerHTML=messages.map(m=>`<div class="chat-message ${m.role}">${m.text}</div>`).join('');
        container.scrollTop=container.scrollHeight;
    }
}
renderChatMessages();

const chatInput=document.getElementById('chat-input');
const chatSend=document.getElementById('chat-send');
function sendMessage(){
    const text=chatInput.value.trim();
    if(!text)return;
    if(!chatStore[activeChatTab])chatStore[activeChatTab]=[];
    chatStore[activeChatTab].push({role:'user',text});
    chatInput.value='';
    renderChatMessages();
    setTimeout(()=>{
        chatStore[activeChatTab].push({role:'ai',text:'–°–ø–∞—Å–∏–±–æ –∑–∞ –≤–æ–ø—Ä–æ—Å! –≠—Ç–æ –¥–µ–º–æ-–≤–µ—Ä—Å–∏—è —á–∞—Ç–∞. –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –°–æ—Ñ–∏–∏ –±—É–¥–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∞–Ω –ø–æ–∑–∂–µ.'});
        renderChatMessages();
    },800);
}
chatSend.addEventListener('click',sendMessage);
chatInput.addEventListener('keypress',e=>{if(e.key==='Enter')sendMessage();});
</script>
</body>
</html>
